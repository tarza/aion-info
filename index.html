<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AION Advisor (Final Complete Version)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #002d62; --secondary-color: #2962ff; --light-bg: #f0f2f5;
            --white-bg: #ffffff; --text-color: #333; --border-color: #e0e0e0;
            --green-color: #25D366; --special-bg: #fffbe6; --special-border: #ffe58f;
            --info-bg: #e8eaf6;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Sarabun', sans-serif; background-color: var(--light-bg);
            color: var(--text-color); margin: 0; padding: 10px; box-sizing: border-box;
        }
        .container {
            width: 100%; max-width: 960px; margin: auto; background-color: var(--white-bg);
            border-radius: 16px; box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            padding: 20px 40px; box-sizing: border-box;
        }
        h1, h2, h3, h4 { color: var(--primary-color); text-align: center; }
        h4 {
            margin-top: 30px; margin-bottom: 15px; padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color); text-align: left;
        }
        .nav-tabs { display: flex; border-bottom: 2px solid var(--border-color); margin-bottom: 30px; }
        .nav-tab {
            padding: 15px 10px; cursor: pointer; font-size: 16px; font-weight: 600;
            border-bottom: 4px solid transparent; transition: all 0.3s ease;
            text-align: center; flex-grow: 1;
        }
        .nav-tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .view { display: none; }
        .view.active { display: block; }
        .form-grid {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 25px; margin-bottom: 25px;
        }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 8px; font-weight: 600; color: #555; cursor: pointer; }
        .form-group input, .form-group select {
            padding: 12px; border: 1px solid var(--border-color); border-radius: 8px;
            font-size: 16px; box-sizing: border-box; font-family: 'Sarabun', sans-serif;
        }
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .checkbox-label {
            display: flex; align-items: center; background-color: #f8f9fa;
            padding: 10px; border-radius: 6px;
        }
        .checkbox-label input { margin-right: 10px; }
        .action-button {
            display: flex; align-items: center; justify-content: center; width: 100%;
            background-image: linear-gradient(to right, #4e54c8 0%, #8f94fb 51%, #4e54c8 100%);
            background-size: 200% auto;
            color: white; border: none; padding: 15px; font-size: 18px; font-weight: bold;
            border-radius: 8px; cursor: pointer; transition: 0.5s;
            margin-top: 30px; box-shadow: 0 4px 15px 0 rgba(76, 76, 175, 0.4);
        }
        .action-button:hover { background-position: right center; }
        .action-button .spinner {
            display: none; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%; border-top-color: #fff;
            animation: spin 1s ease-in-out infinite; margin-right: 10px;
        }
        .action-button.loading .spinner { display: block; }
        .action-button.loading .btn-text { display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #results-container, #comparison-results-container { margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; }
        .result-card {
            border: 1px solid var(--border-color); border-radius: 8px; padding: 20px;
            background-color: var(--white-bg); margin-bottom: 20px;
        }
        .contact-card {
            border: 1px solid var(--border-color); border-radius: 8px; padding: 20px;
            margin-top: 20px; background-color: var(--info-bg);
        }
        .special-privilege {
            margin-top: 15px; padding: 15px; border: 1px solid var(--special-border);
            background-color: var(--special-bg); border-radius: 8px; text-align: center;
        }
        .features-list { list-style-type: '‚úì '; padding-left: 20px; margin-top: 10px; }
        .features-list li { margin-bottom: 5px; }
        .car-options {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin-top: 15px;
        }
        .option {
            background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px;
            padding: 12px 15px; display: flex; align-items: center; cursor: pointer;
        }
        #comparison-table-container table {
            width: 100%; border-collapse: collapse; margin-top: 20px;
        }
        #comparison-table-container th, #comparison-table-container td {
            border: 1px solid var(--border-color); padding: 12px; text-align: center;
            vertical-align: middle;
        }
        #comparison-table-container th {
            background-color: #e8eaf6; color: var(--primary-color);
        }
        #comparison-table-container td:first-child {
            text-align: left;
            font-weight: 600;
        }
        .contact-buttons {
            display: flex; justify-content: center; gap: 20px; margin-top: 20px; flex-wrap: wrap;
        }
        .contact-btn {
            display: inline-block; text-decoration: none; color: white; padding: 12px 25px;
            border-radius: 8px; font-weight: 600; font-size: 16px; transition: opacity 0.3s;
        }
        .btn-line { background-color: var(--green-color); }
        .btn-phone { background-color: var(--secondary-color); }
        .color-box {
            width: 24px; height: 24px; margin-right: 8px;
            border: 1px solid #ccc; border-radius: 50%;
        }
        .color-swatch-container { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
        .color-swatch { display: flex; align-items: center; }
        .auspicious { 
            background-color: #fffbe6; border: 1px solid #ffd700;
            border-radius: 6px; padding: 2px 8px;
        }
        
        .promo-banner {
            background: linear-gradient(45deg, #ffc107, #ff9800);
            border: none;
            border-radius: 10px; padding: 20px; margin-bottom: 25px;
            text-align: center;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            box-shadow: 0 5px 20px rgba(255, 152, 0, 0.4);
            animation: breathe 2.5s infinite ease-in-out;
            cursor: default;
            transition: transform 0.3s ease;
        }
        .promo-banner:hover {
            transform: scale(1.02);
        }
        .promo-banner .main-text {
            font-size: 24px; font-weight: 700;
            display: block;
        }
        .promo-banner .sub-text {
            font-size: 16px; opacity: 0.9;
            display: block;
        }
        @keyframes breathe {
            0% { transform: scale(1); }
            50% { transform: scale(1.015); }
            100% { transform: scale(1); }
        }

        .finance-info-box {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 15px;
            background-color: var(--info-bg);
            border-radius: 8px;
            margin-bottom: 20px;
            align-items: center;
        }
        .finance-info-box .label {
            font-size: 14px;
            color: #555;
            margin-bottom: 5px;
            display: block;
            text-align: left;
        }
        .finance-info-box .value-display {
             font-size: 20px; font-weight: 700; color: var(--primary-color); text-align: center;
        }

        .down-payment-options { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px; }
        .down-payment-options .btn {
            flex-grow: 1; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color);
            background-color: #f8f9fa; cursor: pointer; text-align: center; font-weight: 600;
        }
        .down-payment-options .btn.active {
            background-color: var(--primary-color); color: white; border-color: var(--primary-color);
        }
        .down-payment-options .btn.promo-highlight {
            background: var(--special-bg);
            border-color: var(--special-border);
            color: #c28b00;
        }

        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
            z-index: 1000;
            justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content {
            background: white; padding: 30px 40px; border-radius: 12px;
            width: 90%; max-width: 500px;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transform: scale(0.9); transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-close {
            position: absolute; top: 10px; right: 15px;
            font-size: 30px; font-weight: bold;
            color: #aaa; cursor: pointer;
        }
        .modal-content .result-value { font-size: 36px; font-weight: 700; color: var(--secondary-color); margin: 5px 0 15px 0; }
        .modal-content .result-details { font-size: 16px; color: #333; line-height: 1.8; }

        @media (max-width: 768px) {
            .container { padding: 15px 20px; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üöó AION Advisor</h1>
        
        <div class="nav-tabs">
            <div class="nav-tab active" data-view="wizard-view">1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà</div>
            <div class="nav-tab" data-view="comparison-view">2. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ</div>
            <div class="nav-tab" data-view="finance-view">3. ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î</div>
        </div>

        <div id="wizard-view" class="view active">
             <h4>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label for="profession">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label>
                    <select id="profession">
                        <option value="company_employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option> <option value="business_owner">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à / ‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</option> <option value="freelance">‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå</option> <option value="student">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option> <option value="government_officer">‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option> <option value="doctor">‡πÅ‡∏û‡∏ó‡∏¢‡πå</option> <option value="pilot">‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô</option> <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="birth-day">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡∏≠‡∏∞‡πÑ‡∏£</label>
                    <select id="birth-day">
                        <option value="monday">‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</option><option value="tuesday">‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</option><option value="wednesday">‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò (‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô)</option><option value="wednesday_night">‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò (‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô)</option><option value="thursday">‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</option><option value="friday">‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå</option><option value="saturday">‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå</option><option value="sunday">‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option>
                    </select>
                </div>
            </div>
            <h4>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label for="budget">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
                    <input type="range" id="budget" min="400000" max="2500000" step="50000" value="1200000">
                    <span id="budget-value">1,200,000 ‡∏ö‡∏≤‡∏ó</span>
                </div>
                <div class="form-group">
                    <label for="daily-km">‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (‡∏Å‡∏°.)</label>
                    <select id="daily-km"><option value="30">&lt; 30 ‡∏Å‡∏°.</option><option value="60">30 - 60 ‡∏Å‡∏°.</option><option value="100">60 - 100 ‡∏Å‡∏°.</option><option value="150">&gt; 100 ‡∏Å‡∏°.</option></select>
                </div>
                 <div class="form-group">
                    <label for="passengers">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥</label>
                    <select id="passengers"><option value="2">1-2 ‡∏Ñ‡∏ô</option><option value="4">3-4 ‡∏Ñ‡∏ô</option><option value="5">5+ ‡∏Ñ‡∏ô</option></select>
                </div>
                <div class="form-group">
                    <label for="long-trip">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏•</label>
                     <select id="long-trip"><option value="rarely">‡πÅ‡∏ó‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢</option><option value="sometimes">‡∏õ‡∏µ‡∏•‡∏∞ 2-4 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</option><option value="monthly">‡∏ó‡∏∏‡∏Å 1-2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option><option value="weekly">‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option></select>
                </div>
            </div>
            <h4>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÑ‡∏•‡∏ü‡πå‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h4>
            <div class="form-group">
                <label>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÑ‡∏•‡∏ü‡πå‡∏™‡πÑ‡∏ï‡∏•‡πå (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠)</label>
                <div class="checkbox-group" id="activities">
                    <label class="checkbox-label"><input type="checkbox" value="family">‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</label><label class="checkbox-label"><input type="checkbox" value="camping">‡πÑ‡∏õ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á/‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</label><label class="checkbox-label"><input type="checkbox" value="business">‡∏û‡∏ö‡∏õ‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</label><label class="checkbox-label"><input type="checkbox" value="city">‡∏Ç‡∏±‡∏ö‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á/‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</label>
                </div>
            </div>
             <div class="form-group">
                <label>‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 3 ‡∏Ç‡πâ‡∏≠)</label>
                <div class="checkbox-group" id="priorities">
                    <label class="checkbox-label"><input type="checkbox" value="value">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤</label><label class="checkbox-label"><input type="checkbox" value="performance">‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞</label><label class="checkbox-label"><input type="checkbox" value="tech">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</label><label class="checkbox-label"><input type="checkbox" value="space">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏¢</label><label class="checkbox-label"><input type="checkbox" value="design">‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå</label><label class="checkbox-label"><input type="checkbox" value="range">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡πà‡∏á</label>
                </div>
            </div>
            <button id="recommend-btn" class="action-button">
                 <div class="spinner"></div>
                <span class="btn-text">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì!</span>
            </button>
            <div id="results-container"></div>
        </div>

        <div id="comparison-view" class="view">
            <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h2>
            <div class="car-options" id="car-options-compare"></div>
            <button id="compare-btn" class="action-button">
                 <span class="btn-text">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏•‡∏¢!</span>
            </button>
            <div id="comparison-results-container"></div>
        </div>
        
        <div id="finance-view" class="view">
            <div id="finance-promo-banner" style="display: none;"></div>
            
            <h4>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ‡πÅ‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label for="finance-car-select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</label>
                    <select id="finance-car-select"></select>
                </div>
                <div class="form-group">
                    <label for="finance-profession">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label>
                    <select id="finance-profession">
                        <option value="company_employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
                        <option value="business_owner">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£ / ‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</option>
                        <option value="government_officer">‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                        <option value="state_enterprise_employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏ê‡∏ß‡∏¥‡∏™‡∏≤‡∏´‡∏Å‡∏¥‡∏à</option>
                        <option value="factory_employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</option>
                        <option value="teacher">‡∏Ñ‡∏£‡∏π / ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
                        <option value="doctor">‡πÅ‡∏û‡∏ó‡∏¢‡πå / ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</option>
                        <option value="prosecutor">‡∏≠‡∏±‡∏¢‡∏Å‡∏≤‡∏£ / ‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤</option>
                        <option value="pilot">‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô / ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô</option>
                        <option value="engineer">‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£ / ‡∏™‡∏ñ‡∏≤‡∏õ‡∏ô‡∏¥‡∏Å</option>
                        <option value="freelance">‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå / ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏≠‡∏¥‡∏™‡∏£‡∏∞</option>
                        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                </div>
            </div>

            <div id="other-profession-contact" style="display: none;"></div>
            
            <div class="finance-info-box">
                <div class="form-group">
                    <label for="finance-car-price-input" class="label">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="finance-car-price-input" class="form-group-input">
                </div>
                <div>
                    <label class="label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</label>
                    <div id="finance-interest-rate" class="value-display">-</div>
                </div>
            </div>

            <h4>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞</h4>
            <div class="form-grid">
                 <div class="form-group">
                    <label>‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå</label>
                    <div class="down-payment-options" id="down-payment-presets"></div>
                    <input type="number" id="finance-downpayment-amount" placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" style="margin-top: 10px;">
                </div>
                <div class="form-group">
                    <label for="finance-term">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</label>
                    <select id="finance-term">
                        <option value="48">48</option>
                        <option value="60">60</option>
                        <option value="72">72</option>
                        <option value="84">84</option>
                    </select>
                </div>
            </div>

            <button id="finance-calculate-btn" class="action-button">
                <span class="btn-text">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î</span>
            </button>
        </div>
    </div>

    <div id="finance-result-modal" class="modal-overlay">
        <div class="modal-content">
            <span id="modal-close-btn" class="modal-close">&times;</span>
            <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î</h3>
            <div id="modal-monthly-payment" class="result-value"></div>
            <div id="modal-finance-summary" class="result-details"></div>
            <div id="modal-contact-section"></div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const carData = [
        { id: 'ut_std', model: 'AION UT', subModel: 'Standard', price: 499900, range: 420, hp: 136, space: 2, acceleration_0_100: 12.0, tags: ['city', 'value', 'promo_ut'], features: ['‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î ‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß', '‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°', '‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡∏ù‡∏∏‡πà‡∏ô PM2.5'], colors: [ {name: 'Rococo White', hex: '#F8F8F8'}, {name: 'Seine Silver', hex: '#C0C0C0'}, {name: 'Champs Beige', hex: '#F5F5DC'}, {name: 'Emerald Green', hex: '#009B77'} ], battery_kwh: 50.3, dc_charge_speed: '24 ‡∏ô‡∏≤‡∏ó‡∏µ', dimensions: '4,410 x 1,820 x 1,666', wheel_size: 16 },
        { id: 'ut_prem', model: 'AION UT', subModel: 'Premium', price: 649900, range: 500, hp: 204, space: 2, acceleration_0_100: 7.3, tags: ['city', 'value', 'performance', 'promo_ut'], features: ['‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÅ‡∏£‡∏á‡∏Ç‡∏∂‡πâ‡∏ô 204 ‡πÅ‡∏£‡∏á‡∏°‡πâ‡∏≤', '‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏Å‡∏•‡∏Ç‡∏∂‡πâ‡∏ô 500 ‡∏Å‡∏°.', '‡∏ã‡∏±‡∏ô‡∏£‡∏π‡∏ü‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÅ‡∏ö‡∏ö Panoramic'], colors: [ {name: 'Rococo White', hex: '#F8F8F8'}, {name: 'Seine Silver', hex: '#C0C0C0'}, {name: 'Champs Beige', hex: '#F5F5DC'}, {name: 'Emerald Green', hex: '#009B77'} ], battery_kwh: 60.0, dc_charge_speed: '24 ‡∏ô‡∏≤‡∏ó‡∏µ', dimensions: '4,410 x 1,820 x 1,666', wheel_size: 17 },
        { id: 'y_plus_410', model: 'AION Y Plus', subModel: '410 Elite', price: 769900, range: 410, hp: 204, space: 4, acceleration_0_100: 8.5, tags: ['family', 'space', 'value', 'camping'], features: ['‡∏´‡πâ‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤‡∏á', '‡∏à‡∏≠‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™ 14.6 ‡∏ô‡∏¥‡πâ‡∏ß', '‡πÄ‡∏ö‡∏≤‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏ô‡∏≠‡∏ô‡πÑ‡∏î‡πâ (Camping Mode)'], colors: [ {name: 'Lucky Gold', hex: '#FFD700'}, {name: 'Vitality Green', hex: '#4CAF50'}, {name: 'Speedy Silver', hex: '#BCC6CC'}, {name: 'Liberty Ash', hex: '#95A5A6'}, {name: 'Elegant Gray', hex: '#808080'}, {name: 'Pure White', hex: '#FFFFFF'}, {name: 'Glamour Black', hex: '#000000'} ], battery_kwh: 50.7, dc_charge_speed: '25 ‡∏ô‡∏≤‡∏ó‡∏µ', dimensions: '4,535 x 1,870 x 1,650', wheel_size: 18 },
        { id: 'y_plus_490', model: 'AION Y Plus', subModel: '490 Premium', price: 829900, range: 490, hp: 204, space: 4, acceleration_0_100: 8.5, tags: ['family', 'long_trip', 'space', 'tech', 'camping', 'promo_yplus_490'], features: ['‡∏´‡πâ‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏Ñ‡∏•‡∏≤‡∏™', '‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡∏Å‡∏£‡∏∞‡∏à‡∏Å Panoramic', '‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏Ç‡∏µ‡πà ADAS'], colors: [ {name: 'Lucky Gold', hex: '#FFD700'}, {name: 'Vitality Green', hex: '#4CAF50'}, {name: 'Speedy Silver', hex: '#BCC6CC'}, {name: 'Liberty Ash', hex: '#95A5A6'}, {name: 'Elegant Gray', hex: '#808080'}, {name: 'Pure White', hex: '#FFFFFF'}, {name: 'Glamour Black', hex: '#000000'}, {name: 'Lucky Gold with Black Roof', hex: '#FFD700'}, {name: 'Vitality Green with Black Roof', hex: '#4CAF50'}, {name: 'Pure White with Black Roof', hex: '#FFFFFF'} ], battery_kwh: 63.2, dc_charge_speed: '25 ‡∏ô‡∏≤‡∏ó‡∏µ', dimensions: '4,535 x 1,870 x 1,650', wheel_size: 18 },
        { id: 'v_620', model: 'AION V', subModel: '602 Luxury', price: 949900, range: 602, hp: 224, space: 5, acceleration_0_100: 7.6, tags: ['family', 'long_trip', 'tech', 'space', 'camping', 'business', 'promo_v'], features: ['SUV ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏≠‡∏≠‡∏õ‡∏ä‡∏±‡πà‡∏ô‡∏Ñ‡∏£‡∏ö', '‡πÄ‡∏ö‡∏≤‡∏∞‡∏ô‡∏ß‡∏î‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Ñ‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤', '‡∏°‡∏µ‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß (Cool box)'], colors: [ {name: 'Alpine White', hex: '#F0F8FF'}, {name: 'Onyx Black', hex: '#000000'}, {name: 'Sahara Sand', hex: '#D2B48C'}, {name: 'Aurora Silver', hex: '#E5E4E2'}, {name: 'Iceland Grey', hex: '#607D8B'}, {name: 'Volcano Orange', hex: '#FF4500'}, {name: 'Volcano Orange with White Roof', hex: '#FF4500'} ], battery_kwh: 75.3, dc_charge_speed: '16 ‡∏ô‡∏≤‡∏ó‡∏µ', dimensions: '4,605 x 1,876 x 1,686', wheel_size: 19 },
        { id: 'ht_prem', model: 'HYPTEC HT', subModel: 'Premium', price: 1449000, range: 620, hp: 340, space: 5, acceleration_0_100: 5.8, tags: ['performance', 'long_trip', 'family', 'tech', 'design', 'business'], features: ['‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞‡∏™‡∏π‡∏á 340 ‡πÅ‡∏£‡∏á‡∏°‡πâ‡∏≤', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö', '‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏´‡∏£‡∏π‡∏´‡∏£‡∏≤ ‡πÇ‡∏â‡∏ö‡πÄ‡∏â‡∏µ‡πà‡∏¢‡∏ß'], colors: [ {name: 'Apline White', hex: '#F0F8FF'}, {name: 'Crystal Silver', hex: '#E5E4E2'}, {name: 'Spinel Gray', hex: '#5D5D5D'}, {name: 'Onyx Black', hex: '#000000'} ], battery_kwh: 83.3, dc_charge_speed: '15 ‡∏ô‡∏≤‡∏ó‡∏µ', dimensions: '4,935 x 1,920 x 1,700', wheel_size: 19 },
        { id: 'ht_lux', model: 'HYPTEC HT', subModel: 'Luxury (Gull-Wing)', price: 1749000, range: 620, hp: 340, space: 5, acceleration_0_100: 5.8, tags: ['performance', 'long_trip', 'family', 'tech', 'design', 'business'], features: ['‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏õ‡∏µ‡∏Å‡∏ô‡∏Å (Gull-Wing Doors)', '‡∏†‡∏≤‡∏û‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏´‡∏£‡∏π‡∏´‡∏£‡∏≤ ‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô', '‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞‡∏™‡∏π‡∏á 340 ‡πÅ‡∏£‡∏á‡∏°‡πâ‡∏≤'], colors: [ {name: 'Apline White', hex: '#F0F8FF'}, {name: 'Crystal Silver', hex: '#E5E4E2'}, {name: 'Spinel Gray', hex: '#5D5D5D'}, {name: 'Onyx Black', hex: '#000000'}, {name: 'Star Rose', hex: '#E0B0FF'}, {name: 'Inferno Orange', hex: '#FF4500'} ], battery_kwh: 83.3, dc_charge_speed: '15 ‡∏ô‡∏≤‡∏ó‡∏µ', dimensions: '4,935 x 1,920 x 1,700', wheel_size: 20 }
    ];

    const promoData = {
        promo_ut: {
            name: "<span class='main-text'>üèÜ ‡πÇ‡∏õ‡∏£‡πÉ‡∏´‡∏ç‡πà! ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ!</span><span class='sub-text'>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AION UT ‡∏ó‡∏∏‡∏Å‡∏£‡∏∏‡πà‡∏ô</span>",
            tiers: { '8888': { '48': 4.99, '60': 5.29, '72': 5.39, '84': 5.60 }, '5': { '48': 4.09, '60': 4.39, '72': 4.69, '84': 4.99 }, '10': { '48': 3.69, '60': 3.99, '72': 4.29, '84': 4.59 }, '15': { '48': 3.09, '60': 3.39, '72': 3.59, '84': 4.29 }, '20': { '48': 2.69, '60': 2.89, '72': 3.09, '84': 3.79 }, '25': { '48': 1.98, '60': 2.59, '72': 2.99, '84': 3.59 }, '30': { '48': 1.98, '60': 2.39, '72': 2.89, '84': 3.49 } },
            defaultPresetButtons: ['‡∏î‡∏≤‡∏ß‡∏ô‡πå 8,888', '5%', '10%', '15%', '20%', '25%', '30%'],
            specialProfessionPresetButtons: ['‡∏î‡∏≤‡∏ß‡∏ô‡πå 0%', '‡∏î‡∏≤‡∏ß‡∏ô‡πå 8,888', '5%', '10%', '15%', '20%', '25%', '30%']
        },
        promo_yplus_490: {
            name: "<span class='main-text'>üî• Y Plus 490 ‡∏ü‡∏£‡∏µ‡∏î‡∏≤‡∏ß‡∏ô‡πå!</span><span class='sub-text'>‡∏≠‡∏≠‡∏Å‡∏£‡∏ñ 0 ‡∏ö‡∏≤‡∏ó ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏∏‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</span>",
            tiers: { '8888': { '48': 4.99, '60': 5.29, '72': 5.39, '84': 5.60 }, '5': { '48': 4.89, '60': 5.19, '72': 5.39, '84': 5.60 }, '10': { '48': 3.69, '60': 3.99, '72': 4.29, '84': 4.59 }, '15': { '48': 3.09, '60': 3.39, '72': 3.59, '84': 4.29 }, '20': { '48': 2.69, '60': 2.89, '72': 3.09, '84': 3.79 }, '25': { '48': 1.98, '60': 2.59, '72': 2.99, '84': 3.59 }, '30': { '48': 1.98, '60': 2.39, '72': 2.89, '84': 3.49 } },
            defaultPresetButtons: ['‡∏î‡∏≤‡∏ß‡∏ô‡πå 0%', '‡∏î‡∏≤‡∏ß‡∏ô‡πå 8,888', '5%', '10%', '15%', '20%', '25%', '30%']
        },
        promo_v: {
            name: "<span class='main-text'>‚ú® AION V ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏©</span><span class='sub-text'>‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ 1.98% ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå 25% ‡∏ú‡πà‡∏≠‡∏ô 48 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>",
            special_rate: { down: 25, term: 48, rate: 1.98 },
            defaultPresetButtons: ['10%', '15%', '20%', '25%', '30%'],
            specialProfessionPresetButtons: ['‡∏î‡∏≤‡∏ß‡∏ô‡πå 0%', '10%', '15%', '20%', '25%', '30%']
        }
    };
    const specialProfessionsForDiscount = ['government_officer', 'state_enterprise_employee', 'doctor', 'prosecutor', 'judge', 'teacher'];
    const auspiciousColors = { sunday: { good: ['‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', '‡∏™‡∏µ‡∏î‡∏≥']}, monday: { good: ['‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', '‡∏™‡∏µ‡∏™‡πâ‡∏°']}, tuesday: { good: ['‡∏™‡∏µ‡∏™‡πâ‡∏°', '‡∏™‡∏µ‡∏î‡∏≥']}, wednesday: { good: ['‡∏™‡∏µ‡πÄ‡∏ó‡∏≤', '‡∏™‡∏µ‡∏ü‡πâ‡∏≤']}, wednesday_night: { good: ['‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß', '‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á']}, thursday: { good: ['‡∏™‡∏µ‡∏ü‡πâ‡∏≤', '‡∏™‡∏µ‡πÅ‡∏î‡∏á']}, friday: { good: ['‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', '‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π']}, saturday: { good: ['‡∏™‡∏µ‡πÅ‡∏î‡∏á', '‡∏™‡∏µ‡∏ü‡πâ‡∏≤']} };

    function init() {
        setupTabs();
        setupWizardView();
        setupComparisonView();
        setupFinanceView();
    }
    
    function setupTabs() {
        document.querySelectorAll('.nav-tab').forEach(tab => tab.addEventListener('click', () => switchView(tab.dataset.view)));
    }
    
    function switchView(viewId) {
        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.toggle('active', tab.dataset.view === viewId));
        document.querySelectorAll('.view').forEach(view => view.classList.toggle('active', view.id === viewId));
    }

    function setupWizardView() {
        const budgetSlider = document.getElementById('budget');
        if (!budgetSlider) return;
        budgetSlider.addEventListener('input', () => { document.getElementById('budget-value').textContent = `${Number(budgetSlider.value).toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó`; });
        document.getElementById('recommend-btn').addEventListener('click', handleRecommendation);
    }

    function handleRecommendation() {
        const recommendBtn = document.getElementById('recommend-btn');
        recommendBtn.classList.add('loading');
        setTimeout(() => {
            const inputs = {
                profession: document.getElementById('profession').value,
                birthDay: document.getElementById('birth-day').value,
                budget: Number(document.getElementById('budget').value),
                dailyKm: Number(document.getElementById('daily-km').value),
                passengers: Number(document.getElementById('passengers').value),
                longTrip: document.getElementById('long-trip').value,
                activities: Array.from(document.querySelectorAll('#activities input:checked')).map(el => el.value),
                priorities: Array.from(document.querySelectorAll('#priorities input:checked')).map(el => el.value)
            };
            let recommendations = carData.map(car => {
                let score = 0;
                if (car.price > inputs.budget) return { ...car, score: -1 };
                score += 10 + ((inputs.budget - car.price) / 50000);
                if (car.space >= inputs.passengers) score += 5; else score -= 5;
                if ((car.range / inputs.dailyKm) < 4 && inputs.dailyKm > 60) score -= 5;
                if (inputs.longTrip === 'monthly' && car.range < 500) score -= 5;
                if (inputs.longTrip === 'weekly' && car.range < 600) score -= 10;
                if (car.tags) {
                    inputs.activities.forEach(activity => { if (car.tags.includes(activity)) score += 5; });
                    inputs.priorities.forEach(priority => { if (car.tags.includes(priority)) score += 5; });
                }
                return { ...car, score };
            });
            recommendations = recommendations.filter(car => car.score > 0).sort((a, b) => b.score - a.score);
            renderWizardResults(recommendations.slice(0, 3), inputs);
            recommendBtn.classList.remove('loading');
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
        }, 500);
    }

    function renderWizardResults(cars, inputs) {
        const resultsContainer = document.getElementById('results-container');
        if (cars.length === 0) {
            resultsContainer.innerHTML = '<h3>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3><p>‡∏•‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</p>' + renderContactCard('‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á');
            return;
        }
        const isSpecialProfession = ['government_officer', 'doctor', 'pilot'].includes(inputs.profession);
        const colorMap = { '‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß': ['green'], '‡∏™‡∏µ‡∏î‡∏≥': ['black'], '‡∏™‡∏µ‡∏™‡πâ‡∏°': ['orange'], '‡∏™‡∏µ‡πÄ‡∏ó‡∏≤': ['gray', 'grey', 'ash', 'silver'], '‡∏™‡∏µ‡∏ü‡πâ‡∏≤': ['blue'], '‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß': ['white'], '‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á': ['purple', 'rose'], '‡∏™‡∏µ‡πÅ‡∏î‡∏á': ['red'], '‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π': ['pink', 'rose'] };
        const userAuspiciousThai = auspiciousColors[inputs.birthDay].good;
        const userAuspiciousKeywords = userAuspiciousThai.flatMap(thaiColor => colorMap[thaiColor] || []);
        let html = `<h2>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</h2>`;
        cars.forEach((car, index) => {
            const auspiciousMatches = car.colors.filter(c => userAuspiciousKeywords.some(keyword => c.name.toLowerCase().includes(keyword))).map(c => c.name);
            html += `<div class="result-card"><h3>${index === 0 ? '‚ú® ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1' : `‚úîÔ∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ${index + 1}`}</h3><h2>${car.model} ${car.subModel}</h2><p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${car.price.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó</p><p><strong>‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ‡πÑ‡∏Å‡∏•:</strong> ${car.range} ‡∏Å‡∏°.</p><h4>‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏î‡πà‡∏ô</h4><ul class="features-list">${car.features.map(f => `<li>${f}</li>`).join('')}</ul>${renderAvailableColors(car.colors, auspiciousMatches)}${ (index === 0 && isSpecialProfession) ? renderSpecialPrivilege() : '' }</div>`;
        });
        html += renderContactCard('‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');
        resultsContainer.innerHTML = html;
    }

    function renderAvailableColors(colors, auspiciousMatches = []) {
        const colorHtml = colors.map(c => {
            const isAuspicious = auspiciousMatches.includes(c.name);
            const auspiciousTag = isAuspicious ? '‚≠ê <span style="font-weight:bold;">(‡∏™‡∏µ‡∏°‡∏á‡∏Ñ‡∏•)</span>' : '';
            const swatchClass = isAuspicious ? 'color-swatch auspicious' : 'color-swatch';
            return `<div class="${swatchClass}"><span class="color-box" style="background-color:${c.hex}; border-color:${c.hex === '#FFFFFF' ? '#ddd' : c.hex};"></span> ${c.name} ${auspiciousTag}</div>`;
        }).join('');
        return `<div style="margin-top:15px; padding-top:15px; border-top: 1px solid #eee;"><h4>‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h4><div class="color-swatch-container">${colorHtml}</div></div>`;
    }

    function renderSpecialPrivilege() {
        return `<div class="special-privilege"><strong>‚ú® ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</strong><p style="margin:5px 0 0 0;">‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p></div>`;
    }

    function setupComparisonView() {
        const compareOptionsContainer = document.getElementById('car-options-compare');
        if (!compareOptionsContainer) return;
        carData.forEach(car => {
            const label = document.createElement('label');
            label.className = 'option';
            label.innerHTML = `<input type="checkbox" name="car-select" value="${car.id}"> <span>${car.model} ${car.subModel}</span>`;
            compareOptionsContainer.appendChild(label);
        });
        document.getElementById('compare-btn').addEventListener('click', handleComparison);
    }

    function handleComparison() {
        const resultsContainer = document.getElementById('comparison-results-container');
        const selectedIds = Array.from(document.querySelectorAll('#car-options-compare input:checked')).map(cb => cb.value);
        if (selectedIds.length < 2) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö'); return; }
        const selectedCars = carData.filter(car => selectedIds.includes(car.id));
        renderComparisonTable(selectedCars, resultsContainer);
        resultsContainer.scrollIntoView({ behavior: 'smooth' });
    }

    function renderComparisonTable(cars, container) {
        let tableHTML = `<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h2><div id="comparison-table-container"><table>
            <thead><tr><th>‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥</th>${cars.map(car => `<th>${car.model}<br><small>${car.subModel}</small></th>`).join('')}</tr></thead>
            <tbody>
                <tr><td>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</td>${cars.map(car => `<td>${car.price.toLocaleString('th-TH')}</td>`).join('')}</tr>
                <tr><td>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡πà‡∏á (‡∏Å‡∏°.)</td>${cars.map(car => `<td>${car.range}</td>`).join('')}</tr>
                <tr><td>‡∏Å‡∏≥‡∏•‡∏±‡∏á (‡πÅ‡∏£‡∏á‡∏°‡πâ‡∏≤)</td>${cars.map(car => `<td>${car.hp}</td>`).join('')}</tr>
                <tr><td>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏£‡πà‡∏á 0-100 ‡∏Å‡∏°./‡∏ä‡∏°.</td>${cars.map(car => `<td>${car.acceleration_0_100 ? `${car.acceleration_0_100} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ` : 'N/A'}</td>`).join('')}</tr>
                <tr><td>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà (kWh)</td>${cars.map(car => `<td>${car.battery_kwh}</td>`).join('')}</tr>
                <tr><td>‡∏ä‡∏≤‡∏£‡πå‡∏à‡πÄ‡∏£‡πá‡∏ß DC (30-80%)</td>${cars.map(car => `<td>${car.dc_charge_speed}</td>`).join('')}</tr>
                <tr><td>‡∏Ç‡∏ô‡∏≤‡∏î‡∏•‡πâ‡∏≠ (‡∏ô‡∏¥‡πâ‡∏ß)</td>${cars.map(car => `<td>${car.wheel_size}</td>`).join('')}</tr>
                <tr><td>‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏ñ‡∏±‡∏á (‡∏°‡∏°.)</td>${cars.map(car => `<td>${car.dimensions}</td>`).join('')}</tr>
                <tr><td>‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏î‡πà‡∏ô</td>${cars.map(car => `<td style="text-align:left;"><ul class="features-list">${car.features.map(f => `<li>${f}</li>`).join('')}</ul></td>`).join('')}</tr>
            </tbody></table></div>`;
        tableHTML += renderContactCard('‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');
        container.innerHTML = tableHTML;
    }

    function setupFinanceView() {
        const financeCarSelect = document.getElementById('finance-car-select');
        const professionSelect = document.getElementById('finance-profession');
        const carPriceInput = document.getElementById('finance-car-price-input');
        const calculateBtn = document.getElementById('finance-calculate-btn');
        const modalOverlay = document.getElementById('finance-result-modal');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        if (!financeCarSelect) return;

        carData.forEach(car => {
            const option = document.createElement('option');
            option.value = car.id;
            option.textContent = `${car.model} ${car.subModel}`;
            financeCarSelect.appendChild(option);
        });

        financeCarSelect.addEventListener('change', updateFinanceUI);
        carPriceInput.addEventListener('input', updateFinanceUI);
        document.getElementById('finance-term').addEventListener('change', updateFinanceUI);
        professionSelect.addEventListener('change', () => {
            handleProfessionChange();
            updateFinanceUI();
        });
        document.getElementById('finance-downpayment-amount').addEventListener('input', () => {
             document.querySelectorAll('#down-payment-presets .btn').forEach(b => b.classList.remove('active'));
             updateFinanceUI();
        });
        
        calculateBtn.addEventListener('click', handleFinanceCalculation);
        modalCloseBtn.addEventListener('click', () => modalOverlay.classList.remove('active'));
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                modalOverlay.classList.remove('active');
            }
        });
        
        handleProfessionChange();
        updateFinanceUI(); 
    }
    
    function handleProfessionChange() {
        const profession = document.getElementById('finance-profession').value;
        const contactContainer = document.getElementById('other-profession-contact');
        if (profession === 'other') {
            contactContainer.innerHTML = renderContactCard('‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î');
            contactContainer.style.display = 'block';
        } else {
            contactContainer.style.display = 'none';
        }
    }

    function updateFinanceUI() {
        const selectedCarId = document.getElementById('finance-car-select').value;
        const selectedCar = carData.find(c => c.id === selectedCarId);
        if (!selectedCar) return;
        
        const carPriceInput = document.getElementById('finance-car-price-input');
        if (document.activeElement !== carPriceInput) {
            carPriceInput.value = selectedCar.price;
        }
        const currentCarPrice = Number(carPriceInput.value);

        const profession = document.getElementById('finance-profession').value;
        const isSpecialProfession = specialProfessionsForDiscount.includes(profession);
        
        const promoBanner = document.getElementById('finance-promo-banner');
        const downPaymentPresetsContainer = document.getElementById('down-payment-presets');
        downPaymentPresetsContainer.innerHTML = '';
        
        const currentPromoKey = selectedCar.tags?.find(tag => promoData[tag]);
        const currentPromo = currentPromoKey ? promoData[currentPromoKey] : null;

        if (currentPromo) {
            promoBanner.innerHTML = currentPromo.name;
            promoBanner.style.display = 'block';
            let presetButtons = currentPromo.defaultPresetButtons;
            if (currentPromo.specialProfessionPresetButtons && isSpecialProfession) {
                presetButtons = currentPromo.specialProfessionPresetButtons;
            }
            
            presetButtons.forEach(tier => {
                const btn = document.createElement('button');
                btn.type = 'button'; btn.className = 'btn'; btn.textContent = tier;
                if (tier === '‡∏î‡∏≤‡∏ß‡∏ô‡πå 8,888') {
                    btn.classList.add('promo-highlight');
                    btn.dataset.tier = '8888';
                } else {
                    btn.dataset.tier = tier.replace('‡∏î‡∏≤‡∏ß‡∏ô‡πå ', '').replace('%', '');
                }
                downPaymentPresetsContainer.appendChild(btn);
            });
        } else {
            promoBanner.style.display = 'none';
            const defaultButtons = isSpecialProfession ? ['‡∏î‡∏≤‡∏ß‡∏ô‡πå 0%', '10%', '15%', '20%', '25%', '30%'] : ['10%', '15%', '20%', '25%', '30%'];
            defaultButtons.forEach(tier => {
                const btn = document.createElement('button');
                btn.type = 'button'; btn.className = 'btn'; btn.textContent = tier;
                btn.dataset.tier = tier.replace('‡∏î‡∏≤‡∏ß‡∏ô‡πå ', '').replace('%', '');
                downPaymentPresetsContainer.appendChild(btn);
            });
        }
        
        downPaymentPresetsContainer.onclick = function(e) {
            if (e.target.classList.contains('btn')) {
                document.querySelectorAll('#down-payment-presets .btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                const tier = e.target.dataset.tier;
                let downPaymentAmount = 0;
                if (tier === '8888') { downPaymentAmount = 8888; }
                else if (tier === '0') { downPaymentAmount = 0; }
                else { downPaymentAmount = Math.round(currentCarPrice * (Number(tier) / 100)); }
                
                document.getElementById('finance-downpayment-amount').value = downPaymentAmount;
                updateFinanceUI();
            }
        };

        const term = document.getElementById('finance-term').value;
        const downPaymentAmount = Number(document.getElementById('finance-downpayment-amount').value) || 0;
        const downPercent = currentCarPrice > 0 ? (downPaymentAmount / currentCarPrice) * 100 : 0;
        let interestRate = null;

        if (currentPromoKey === 'promo_v') {
            if (downPercent >= currentPromo.special_rate.down && term == currentPromo.special_rate.term) {
                interestRate = currentPromo.special_rate.rate;
            } else {
                const fallbackPromo = promoData.promo_ut;
                let tierKey = null;
                if (isSpecialProfession && downPaymentAmount === 0) {
                    tierKey = '0';
                } else {
                    const tiers = Object.keys(fallbackPromo.tiers).filter(t => t !== '8888' && Number(t) >= 10).map(Number).sort((a,b) => a - b);
                    for (let i = tiers.length - 1; i >= 0; i--) {
                        if (downPercent >= tiers[i]) { tierKey = tiers[i].toString(); break; }
                    }
                }
                let lookupTierKey = tierKey;
                if (tierKey === '0' && isSpecialProfession) { lookupTierKey = '10'; }
                if (lookupTierKey && fallbackPromo.tiers[lookupTierKey] && fallbackPromo.tiers[lookupTierKey][term]) {
                    interestRate = fallbackPromo.tiers[lookupTierKey][term];
                }
            }
        } else if (currentPromo) {
            const activePreset = document.querySelector('#down-payment-presets .btn.active');
            let tierKey = null;
            if (activePreset) {
                tierKey = activePreset.dataset.tier;
            } else if (downPaymentAmount >= 0) {
                 if (downPaymentAmount === 8888) { tierKey = '8888'; }
                 else {
                    if (downPaymentAmount === 0 && (isSpecialProfession || currentPromo.defaultPresetButtons.includes('‡∏î‡∏≤‡∏ß‡∏ô‡πå 0%'))) {
                        tierKey = '0';
                    } else {
                         const tiers = Object.keys(currentPromo.tiers).filter(t => t !== '8888').map(Number).sort((a,b) => a - b);
                         for (let i = tiers.length - 1; i >= 0; i--) {
                            if (downPercent >= tiers[i]) { tierKey = tiers[i].toString(); break; }
                        }
                    }
                 }
            }
            let lookupTierKey = tierKey;
            if (tierKey === '0') { lookupTierKey = '10'; }
            if (lookupTierKey && currentPromo.tiers[lookupTierKey] && currentPromo.tiers[lookupTierKey][term]) {
                interestRate = currentPromo.tiers[lookupTierKey][term];
            }
        } else {
            const fallbackPromo = promoData.promo_ut;
            let tierKey = null;
            if (isSpecialProfession && downPaymentAmount === 0) {
                tierKey = '0';
            } else {
                const tiers = Object.keys(fallbackPromo.tiers).filter(t => t !== '8888').map(Number).sort((a,b) => a - b);
                for (let i = tiers.length - 1; i >= 0; i--) {
                    if (downPercent >= tiers[i]) { tierKey = tiers[i].toString(); break; }
                }
            }
            let lookupTierKey = tierKey;
            if (tierKey === '0' && isSpecialProfession) { lookupTierKey = '10'; }
            if (lookupTierKey && fallbackPromo.tiers[lookupTierKey] && fallbackPromo.tiers[lookupTierKey][term]) {
                interestRate = fallbackPromo.tiers[lookupTierKey][term];
            }
        }

        if (interestRate !== null && isSpecialProfession) {
            interestRate -= 0.20;
        }

        document.getElementById('finance-interest-rate').textContent = interestRate ? `${interestRate.toFixed(2)}%` : '-';
    }

    function handleFinanceCalculation() {
        const modalOverlay = document.getElementById('finance-result-modal');
        const modalContactSection = document.getElementById('modal-contact-section');
        const carPrice = Number(document.getElementById('finance-car-price-input').value);
        if (!carPrice || carPrice <= 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ'); return; }

        const downPaymentAmount = Number(document.getElementById('finance-downpayment-amount').value);
        const term = Number(document.getElementById('finance-term').value);
        const rateString = document.getElementById('finance-interest-rate').textContent;

        if (downPaymentAmount < 0) { alert('‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÑ‡∏î‡πâ'); return; }
        if (!rateString.includes('%') || parseFloat(rateString) <= 0) {
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ'); return;
        }

        const annualRate = parseFloat(rateString);
        const principal = carPrice - downPaymentAmount;
        if (principal < 0) { alert('‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ'); return; }

        if (principal <= 0 && downPaymentAmount >= carPrice) {
            document.getElementById('modal-monthly-payment').textContent = '‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î';
            document.getElementById('modal-finance-summary').innerHTML = `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ: <b>${carPrice.toLocaleString('th-TH')}</b> ‡∏ö‡∏≤‡∏ó<br>‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b>${downPaymentAmount.toLocaleString('th-TH')}</b> ‡∏ö‡∏≤‡∏ó`;
        } else {
            const monthlyRate = annualRate / 100 / 12;
            const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, term)) / (Math.pow(1 + monthlyRate, term) - 1);
            const totalInterest = (monthlyPayment * term) - principal;
            document.getElementById('modal-monthly-payment').textContent = `‡∏ø ${Math.ceil(monthlyPayment).toLocaleString('th-TH')}`;
            document.getElementById('modal-finance-summary').innerHTML = `
                ‡∏¢‡∏≠‡∏î‡∏à‡∏±‡∏î‡πÑ‡∏ü‡πÅ‡∏ô‡∏ô‡∏ã‡πå: <b>${principal.toLocaleString('th-TH')}</b> ‡∏ö‡∏≤‡∏ó<br>
                ‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞: <b>${term}</b> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô<br>
                ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b>${Math.ceil(totalInterest).toLocaleString('th-TH')}</b> ‡∏ö‡∏≤‡∏ó (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)
            `;
        }
        
        modalContactSection.innerHTML = renderContactCard('‡∏™‡∏ô‡πÉ‡∏à‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ô‡∏µ‡πâ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢!');
        modalOverlay.classList.add('active');
    }

    function renderContactCard(title) {
        return `<div class="contact-card">
                    <h3 style="text-align:center;">${title}</h3>
                    <div class="contact-buttons">
                        <a href="https://line.me/ti/p/~admin.454" target="_blank" class="contact-btn btn-line">‚úÖ ‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå: admin.454</a>
                        <a href="tel:0817003057" class="contact-btn btn-phone">üìû ‡πÇ‡∏ó‡∏£: 081-700-3057</a>
                    </div>
                </div>`;
    }
    
    init();
});
</script>

</body>
</html>
